% !TeX spellcheck = en_US
% !TeX encoding = UTF-8
% !TeX root = ../thesis.tex

\chapter{Evaluation}
In this chapter we will describe the setup for our experiments and discuss
the results we obtained.

\section{Setup}
All algorithms were implemented in python,
the optimization algorithm for MORE is Low-storage BFGS
from nlopt\footnote{\href{https://nlopt.readthedocs.io/en/latest/}
  {https://nlopt.readthedocs.io/en/latest/}}.
The clusterwork2 (cw2) framework, developed at the ALR group, was used for
running experiments in an convenient way.
The experiments were conducted on a machine with two 8-core
AMD Ryzen 2700X processores clocked at 2.6 GHz and 31GB of RAM.

\subsection{Hyperparameter Search}
% - do this better --> compare ALGO II theses

% - do great graphics, tables, figures for this

% - try doing a sweep with wandb (or manually)

% - research how to do good algorithm engineering
% make table of parameters to tune
% look for best way to show results (table with highlighted numbers)

We did a mixture of manual hyperparameter tuning and grid search
with the cw2 framework. (name some number of different parameter
sets tested)
The parameters used for optimization are listed.
\subsubsection{MORE parameters}
\begin{itemize}
\item KL-Bound $\epsilon$
\item entropy-loss bound $\beta$
\end{itemize}
\subsubsection{RLS parameters}
\begin{itemize}
\item model noise $\mathbf{Q}$
\item measurement noise $\sigma^2$
\end{itemize}

\section{Experiments}
\subsection{Test Functions for Optimization}
\label{sec:test_func}
Test functions provide artificial landscapes to evaluate the
performance of optimization algorithms. They can be used to
assess robustness, convergence speed and general performance of the
algorithms \citep{molga2005test}.

The Rosenbrock function (\cref{fig:rosenbrock}) is unimodal and convex.
It has one global optimum which is inside a parabolic shaped flat valley.
It is usually easy to find the valley,
however finding the global optimum is particularly difficult,
which makes this function popular with testing algorithmsâ€™ performance.
It is defined as 
\begin{equation*}
 f(x) = \sum^{n-1}_{i=1} [100(x_{i+1} - x_i^2)^2 + (1-x_i)^2].
\end{equation*}

\begin{figure}[ht!]
    \centering
    \includesvg[width=0.4\textwidth]{figures/rosenbrock_function}
    \caption{2D Rosenbrock function}
    \label{fig:rosenbrock}
\end{figure}

We test our algorithm on a 8 dim and 15 dimensional version of the
rosenbrock function

% TODO add result on rosenbrock 8 dim on the side
% TODO look for styling plots --> make them look better
\begin{figure}[ht!]
     \centering
     \input{figures/rosenbrock15dim}
     \hspace{1cm}                       
     \caption{This figure shows the median of (10 runs) for RLS, LS and BLR (original MORE) on 15 dimensional Rosenbrock}
     \label{fig:15dim}  
\end{figure}

% minipage example
%\begin{figure}
%    \centering
%    \begin{minipage}{0.45\textwidth}
%      \centering
%      \includegraphics[width=1\textwidth]{figures/5dim}
%      \hspace{1cm}                       
%      \caption{5 dimensional Rosenbrock}
%      \label{fig:5dim}
%    \end{minipage}\hfill
%    \begin{minipage}{0.45\textwidth}
%      \centering
%      \includegraphics[width=1\textwidth]{figures/15dim}
%      \hspace{1cm}                       
%      \caption{15 dimensional Rosenbrock}
%      \label{fig:15dim}
%    \end{minipage}
%  \end{figure}

\subsection{Planar Reaching Tasks}
\subsubsection{Dynamic Movement Primitives}
- dynamic system-based motor primitives based on work [Ijspeert 2002, Schaal 2003,2007]
improved imitation and reinforcementlearning

- represent both discrete point-to-point movements as well as rhythmic motion
with motor primitives

- first system canonical system (phase variable)

- we can build complex motor skills from basic primitives,
  its based on dynamical systems

- discrete movement primitives using only a single first order system

- key advantage the second system is linear in the shape parameters and can
  be efficiently learned

- initialized with imitation learning

- DMPs as policy representation

\subsection{Via Point Reaching Task}
- TODO: create figure to explain task

We used a 5 link robot, similar to MORE setup.
Therefore 25 dimensions of the problem, which should be at viapoint (1,1)
at time step 100 and at viapoint (5,0) at timestep 200.
In \Cref{fig:blr_via} we see the task solved by the original MORE algorithm.

Problem of 351 parameters for recursive least squares

\begin{figure}[ht!]
  \centering
     \includesvg[width=0.6\textwidth]{figures/blr_via}
     \hspace{1cm}                       
     \caption{This figure shows the movement resulting from the policy
       learned by BLR for the viapoint reaching task.
       The postures of the resulting motion are shown as overlay,
       where darker postures indicate a posture which
       is close in time to the hole.}
     \label{fig:blr_via}  
\end{figure}

% \subsection{Mujoco Reaching Task}
% Using mujoco we use a simulated reaching task.

\subsection{Tests on Performance}
Here I want to include some tests on different versions
of final algorithm and what we learned form experiments.
Like using weighted model noise on older samples, and
normalization but also different KL-bounds etc.

% do sections for different tests performed
% put most tests, graphs into appendix
%- TODO: place this into appendix?

Tests on data preprocessing methods, different normalization techniques.
Whitening very important, making it possible to track the model parameters
more easily.

- compare normalization techniques (moving average, batch normalization)

- best performance comparison (more iterations)

- best performance comparison of different methods (total samples)

- test influence of KL bound

- test influence of whitening, normalization?

- test influence of noise of drift model

\section{Evaluation}
- some theoretical problems: sample pool, model noise

- improve sample efficency of rosenbrock and reaching task,
better than original MORE and beating CMA-ES benchmark

